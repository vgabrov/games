<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phrasal Verb Fiasco</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes flash-green {
      0% { background-color: #10b981; }
      100% { background-color: transparent; }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    .flash-green { animation: flash-green 0.5s ease-in-out; }
    .shake { animation: shake 0.5s ease-in-out; }
    #sprite { font-size: 2rem; transition: all 0.3s; }
    @media (max-width: 640px) {
      #game-container, #menu-container, #game-over { max-width: 90%; }
      button { font-size: 1rem; padding: 0.5rem; }
    }
  </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen">
  <!-- Pre-game Menu -->
  <div id="menu-container" class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
    <h1 class="text-2xl font-bold text-center mb-4">Phrasal Verb Fiasco - Setup</h1>
    
    <div class="mb-4">
      <label class="block text-sm font-medium mb-2">Difficulty Level:</label>
      <select id="difficulty" class="w-full p-2 border rounded">
        <option value="easy">Easy (+8/-3 points)</option>
        <option value="medium" selected>Medium (+10/-5 points)</option>
        <option value="hard">Hard (+12/-7 points)</option>
      </select>
    </div>
    
    <div class="mb-4">
      <label class="block text-sm font-medium mb-2">Topic:</label>
      <select id="topic" class="w-full p-2 border rounded">
        <option value="general">General (All Scenarios)</option>
        <option value="work">Work</option>
        <option value="social">Social Situations</option>
        <option value="travel">Travel & Tourism (Cafes, Banks, etc.)</option>
      </select>
    </div>
    
    <div class="mb-4">
      <label class="block text-sm font-medium mb-2">Number of Questions (1-50):</label>
      <input type="number" id="num-questions" min="1" max="50" value="50" class="w-full p-2 border rounded">
    </div>
    
    <div class="mb-4 flex items-center">
      <input type="checkbox" id="timer-toggle" class="mr-2">
      <label for="timer-toggle" class="text-sm font-medium">Enable Timer</label>
    </div>
    
    <div id="timer-input" class="mb-4 hidden">
      <label class="block text-sm font-medium mb-2">Time Limit per Question (5-60 seconds):</label>
      <input type="number" id="time-limit" min="5" max="60" value="15" class="w-full p-2 border rounded">
    </div>
    
    <button id="start-button" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">Start Game</button>
  </div>

  <!-- Game Container -->
  <div id="game-container" class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md hidden">
    <h1 class="text-2xl font-bold text-center mb-4">Phrasal Verb Fiasco</h1>
    <p id="score" class="text-center mb-4">Score: <span id="score-value">0</span> (Min: -10)</p>
    <div class="mb-2">
      <div class="w-full bg-gray-200 rounded-full h-2.5">
        <div id="progress" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
      </div>
      <p id="progress-text" class="text-center text-sm text-gray-600">Question 1/50</p>
    </div>
    <div id="sprite" class="text-center mb-4">üßë‚Äçüéì</div>
    <div id="scenario-emojis" class="text-center mb-2 text-3xl"></div>
    <p id="scenario" class="mb-4 text-gray-700"></p>
    <div id="choices" class="space-y-2"></div>
    <div id="timer-display" class="text-center text-xl font-bold hidden mb-2"></div>
    <p id="feedback" class="mt-4 text-gray-700 hidden"></p>
    <button id="next-button" class="mt-4 w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 hidden">Next Scenario</button>
  </div>

  <!-- Game Over -->
  <div id="game-over" class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md hidden mt-4">
    <p id="game-over-message" class="text-center"></p>
    <button id="restart-button" class="mt-2 w-full bg-green-500 text-white py-2 rounded hover:bg-green-600">Restart Game</button>
  </div>

  <!-- Audio Placeholders (replace src with your .mp3/.wav files) -->
  <audio id="correct-sound" preload="auto">
    <source src="correct.mp3" type="audio/mpeg">
  </audio>
  <audio id="wrong-sound" preload="auto">
    <source src="wrong.mp3" type="audio/mpeg">
  </audio>

  <script>
  // Scenarios (104 total: 26 general, 26 work, 26 social, 26 travel)
  const scenarios = [
    // General (26 scenarios)
    { topic: "general", text: "You need to start your car. What do you do? üöó", emojis: "üöóüîë", choices: [
      { text: "I turn it on.", correct: true, feedback: "Nice! The car roars to life. üòé" },
      { text: "I turn it off.", correct: false, feedback: "It's already off, silly! You sit in silence. üòÖ" },
      { text: "I turn it up.", correct: false, feedback: "You blast the radio instead of starting the engine! üé∂" },
      { text: "I turn it down.", correct: false, feedback: "You dim the headlights... still not moving! üò¥" }
    ]},
    { topic: "general", text: "Your room is a mess. What do you do? üßπ", emojis: "üßπüè†", choices: [
      { text: "I clean it up.", correct: true, feedback: "Spotless room, well done! ‚ú®" },
      { text: "I clean it out.", correct: false, feedback: "You throw everything away, including your phone! üò±" },
      { text: "I clean it off.", correct: false, feedback: "You wipe the walls... but the floor's still dirty! üòÜ" },
      { text: "I clean it down.", correct: false, feedback: "You flood the room with water‚Äînow it's a swamp! üåä" }
    ]},
    { topic: "general", text: "Your shoes are dirty. What do you do? üëü", emojis: "üëüüßº", choices: [
      { text: "I clean them off.", correct: true, feedback: "Shiny shoes, ready to step out! ‚ú®" },
      { text: "I clean them up.", correct: false, feedback: "You organize your shoes instead of cleaning them! üòÖ" },
      { text: "I clean them out.", correct: false, feedback: "You empty your shoes... of what, socks? üòÜ" },
      { text: "I clean them in.", correct: false, feedback: "You wash them inside out‚Äîsoggy mess! üåä" }
    ]},
    { topic: "general", text: "You want to relax with music. What do you do? üé∂", emojis: "üé∂üõãÔ∏è", choices: [
      { text: "I turn it on.", correct: true, feedback: "Tunes playing, vibes perfect! üòé" },
      { text: "I turn it off.", correct: false, feedback: "Silence reigns, but where‚Äôs the chill? üò¥" },
      { text: "I turn it up.", correct: false, feedback: "You blast it so loud, neighbors complain! üì¢" },
      { text: "I turn it down.", correct: false, feedback: "You mute it‚Äîno music, no fun! üòÖ" }
    ]},
    { topic: "general", text: "Your dog is chewing your shoes. What do you do? üê∂", emojis: "üê∂üëü", choices: [
      { text: "I tell it off.", correct: true, feedback: "Dog stops, shoes saved! Good job! üêï" },
      { text: "I tell it up.", correct: false, feedback: "You cheer the dog to chew faster! üò±" },
      { text: "I tell it out.", correct: false, feedback: "You send the dog outside with your shoe! üèÉ" },
      { text: "I tell it in.", correct: false, feedback: "You invite the dog to chew indoors more! üòÜ" }
    ]},
    { topic: "general", text: "You need to prepare for a picnic. What do you do? üß∫", emojis: "üß∫üå≥", choices: [
      { text: "I pack it up.", correct: true, feedback: "Picnic basket ready‚Äîlet‚Äôs eat! üçé" },
      { text: "I pack it in.", correct: false, feedback: "You cancel the picnic and stay home! üò¥" },
      { text: "I pack it off.", correct: false, feedback: "You ship the basket to Narnia! üì¶" },
      { text: "I pack it out.", correct: false, feedback: "You empty the basket‚Äîstarving time! üòÖ" }
    ]},
    { topic: "general", text: "Your TV isn‚Äôt working. What do you do? üì∫", emojis: "üì∫üîß", choices: [
      { text: "I fix it up.", correct: true, feedback: "TV‚Äôs back on‚Äîmovie night saved! üé¨" },
      { text: "I fix it out.", correct: false, feedback: "You throw the TV out the window! üò±" },
      { text: "I fix it in.", correct: false, feedback: "You lock the TV in a closet‚Äîwhy? üîí" },
      { text: "I fix it off.", correct: false, feedback: "You turn it off forever‚Äîno shows! üò¥" }
    ]},
    { topic: "general", text: "Your phone battery is low. What do you do? üì±", emojis: "üì±üîã", choices: [
      { text: "I plug it in.", correct: true, feedback: "Charging nicely‚Äîfull power soon! ‚ö°Ô∏è" },
      { text: "I plug it up.", correct: false, feedback: "You block the port with lint‚Äîdead battery! üòñ" },
      { text: "I plug it out.", correct: false, feedback: "You unplug a stranger's charger‚Äîfight ensues! üò¨" },
      { text: "I plug it off.", correct: false, feedback: "You turn off the phone to 'save' it... oops! üò¥" }
    ]},
    { topic: "general", text: "You need to leave a party early. What do you do? üéà", emojis: "üéàüö™", choices: [
      { text: "I slip out.", correct: true, feedback: "You leave unnoticed‚Äîsmooth exit! üòé" },
      { text: "I slip up.", correct: false, feedback: "You trip over a balloon and spill drinks! üòÖ" },
      { text: "I slip in.", correct: false, feedback: "You sneak back in for more cake by mistake! ü•≥" },
      { text: "I slip off.", correct: false, feedback: "You doze off on the couch‚Äîinvisible no more! üò¥" }
    ]},
    { topic: "general", text: "You‚Äôre cold at home. What do you do? ü•∂", emojis: "ü•∂üî•", choices: [
      { text: "I warm up.", correct: true, feedback: "Cozy and warm‚Äîperfect! ü•∞" },
      { text: "I warm out.", correct: false, feedback: "You step outside to warm up‚Äîfreezing! ‚ùÑÔ∏è" },
      { text: "I warm off.", correct: false, feedback: "You turn off the heater‚Äîbrrr! üò£" },
      { text: "I warm in.", correct: false, feedback: "You trap heat in a jar‚Äîuseless! üòÜ" }
    ]},
    { topic: "general", text: "You need to learn a new skill. What do you do? üìö", emojis: "üìöüß†", choices: [
      { text: "I pick it up.", correct: true, feedback: "Skill mastered‚Äînice work! ü•≥" },
      { text: "I pick it out.", correct: false, feedback: "You choose a random skill and fail! üòÖ" },
      { text: "I pick it off.", correct: false, feedback: "You peel off the book‚Äôs cover‚Äîoops! üòÜ" },
      { text: "I pick it in.", correct: false, feedback: "You hide the skill in your brain‚Äîforgotten! üò¥" }
    ]},
    { topic: "general", text: "Your friend left dishes in the sink. What do you do? üçΩÔ∏è", emojis: "üçΩÔ∏èüßº", choices: [
      { text: "I wash them up.", correct: true, feedback: "Dishes sparkling‚Äîkitchen hero! ‚ú®" },
      { text: "I wash them out.", correct: false, feedback: "You rinse them outside‚Äîwhy? üòÖ" },
      { text: "I wash them off.", correct: false, feedback: "You wipe them and leave crumbs! üòÜ" },
      { text: "I wash them in.", correct: false, feedback: "You soak them in a bucket‚Äîmessy! üåä" }
    ]},
    { topic: "general", text: "You‚Äôre late for an appointment. What do you do? ‚è∞", emojis: "‚è∞üèÉ", choices: [
      { text: "I hurry up.", correct: true, feedback: "You make it just in time‚Äîphew! üòé" },
      { text: "I hurry out.", correct: false, feedback: "You run out without your keys! üò£" },
      { text: "I hurry off.", correct: false, feedback: "You flee in the wrong direction! üòÖ" },
      { text: "I hurry in.", correct: false, feedback: "You rush into the wrong room! üòÜ" }
    ]},
    { topic: "general", text: "You need to save some money. What do you do? üí∞", emojis: "üí∞üê∑", choices: [
      { text: "I save it up.", correct: true, feedback: "Piggy bank full‚Äîfuture secured! ü•≥" },
      { text: "I save it out.", correct: false, feedback: "You spend it all outside‚Äîbroke! üò£" },
      { text: "I save it off.", correct: false, feedback: "You avoid saving entirely‚Äîoops! üòÖ" },
      { text: "I save it in.", correct: false, feedback: "You hide cash in a sock‚Äîlost it! üòÜ" }
    ]},
    { topic: "general", text: "You're running out of groceries. What do you do? üõí", emojis: "üõíüçé", choices: [
      { text: "I stock up.", correct: true, feedback: "Pantry overflowing‚Äîprepared for weeks! ü•≥" },
      { text: "I stock out.", correct: false, feedback: "You sell your empty fridge at a yard sale! üòÖ" },
      { text: "I stock in.", correct: false, feedback: "You lock the few items away from yourself! üîí" },
      { text: "I stock off.", correct: false, feedback: "You ignore it and order pizza forever! üò¥üçï" }
    ]},
    { topic: "general", text: "Your team needs motivation. What do you do? üöÄ", emojis: "üöÄüë•", choices: [
      { text: "I fire them up.", correct: true, feedback: "Team's energized and productive! üí™" },
      { text: "I fire them out.", correct: false, feedback: "You send the whole team home early! üòÆ" },
      { text: "I fire them off.", correct: false, feedback: "You launch emails like fireworks‚Äîspam alert! üéÜ" },
      { text: "I fire them in.", correct: false, feedback: "You trap them in a tiny room for 'focus'! üîí" }
    ]},
    { topic: "general", text: "You‚Äôre overwhelmed with tasks. What do you do? üìã", emojis: "üìãüòì", choices: [
      { text: "I sort it out.", correct: true, feedback: "Tasks organized‚Äîstress gone! üòé" },
      { text: "I sort it up.", correct: false, feedback: "You pile tasks higher‚Äîchaos! üò£" },
      { text: "I sort it off.", correct: false, feedback: "You ignore them all‚Äîdisaster! üòÖ" },
      { text: "I sort it in.", correct: false, feedback: "You hide tasks in a drawer‚Äîforgotten! üòÜ" }
    ]},
    { topic: "general", text: "You need to prepare for a big event. What do you do? üéâ", emojis: "üéâüìÖ", choices: [
      { text: "I gear up.", correct: true, feedback: "Ready for the event‚Äîbring it on! ü•≥" },
      { text: "I gear out.", correct: false, feedback: "You pack camping gear instead! üòÖ" },
      { text: "I gear off.", correct: false, feedback: "You skip preparations‚Äîunready! üò£" },
      { text: "I gear in.", correct: false, feedback: "You lock yourself in gear‚Äîstuck! üòÜ" }
    ]},
    { topic: "general", text: "Your car is low on fuel. What do you do? ‚õΩ", emojis: "‚õΩüöó", choices: [
      { text: "I fill it up.", correct: true, feedback: "Tank full‚Äîroad trip ready! üõ£Ô∏è" },
      { text: "I fill it out.", correct: false, feedback: "You write a fuel report‚Äîuseless! üòÖ" },
      { text: "I fill it off.", correct: false, feedback: "You ignore it‚Äîstranded! üò£" },
      { text: "I fill it in.", correct: false, feedback: "You pour fuel in the trunk‚Äîmessy! üòÜ" }
    ]},
    { topic: "general", text: "You want to improve your fitness. What do you do? üèãÔ∏è", emojis: "üèãÔ∏èüí™", choices: [
      { text: "I work out.", correct: true, feedback: "Muscles growing‚Äîfitness goals met! üí™" },
      { text: "I work up.", correct: false, feedback: "You get overly excited and crash! üòÖ" },
      { text: "I work off.", correct: false, feedback: "You skip the gym entirely! üò¥" },
      { text: "I work in.", correct: false, feedback: "You exercise indoors‚Äîcramped space! üòÜ" }
    ]},
    { topic: "general", text: "You want to tidy your bookshelf. What do you do? üìö", emojis: "üìöüè†", choices: [
      { text: "I straighten it up.", correct: true, feedback: "Books aligned‚Äîlibrary vibes! üìñ" },
      { text: "I straighten it out.", correct: false, feedback: "You flatten the books‚Äîpancake pages! üòÖ" },
      { text: "I straighten it off.", correct: false, feedback: "You ignore the mess‚Äîbooks fall! üò£" },
      { text: "I straighten it in.", correct: false, feedback: "You push books into a box‚Äîhidden chaos! üòÜ" }
    ]},
    { topic: "general", text: "Your computer is slow. What do you do? üíª", emojis: "üíª‚è≥", choices: [
      { text: "I speed it up.", correct: true, feedback: "Computer‚Äôs zooming now‚Äînice fix! üöÄ" },
      { text: "I speed it out.", correct: false, feedback: "You throw it out the window‚Äîcrash! üò±" },
      { text: "I speed it off.", correct: false, feedback: "You turn it off‚Äîstill slow! üò¥" },
      { text: "I speed it in.", correct: false, feedback: "You cram more apps in‚Äîslower! üòÖ" }
    ]},
    { topic: "general", text: "You need to fix a leaky faucet. What do you do? üö∞", emojis: "üö∞üîß", choices: [
      { text: "I patch it up.", correct: true, feedback: "No more leaks‚Äîplumbing pro! üõ†Ô∏è" },
      { text: "I patch it out.", correct: false, feedback: "You tape it outside‚Äîflood! üåä" },
      { text: "I patch it off.", correct: false, feedback: "You ignore it‚Äîdrip drip! üò£" },
      { text: "I patch it in.", correct: false, feedback: "You plug it with gum‚Äîmessy! üòÜ" }
    ]},
    { topic: "general", text: "You want to watch a movie at home. What do you do? üé¨", emojis: "üé¨üõãÔ∏è", choices: [
      { text: "I set it up.", correct: true, feedback: "Popcorn ready, movie on‚Äîperfect night! üçø" },
      { text: "I set it out.", correct: false, feedback: "You screen it in the backyard‚Äîbugs join! ü¶ü" },
      { text: "I set it off.", correct: false, feedback: "You trigger the fire alarm‚Äîmovie ruined! üö®" },
      { text: "I set it in.", correct: false, feedback: "You hide the TV in a closet‚Äîno movie! üòÖ" }
    ]},
    { topic: "general", text: "Your bike has a flat tire. What do you do? üö≤", emojis: "üö≤üõ†Ô∏è", choices: [
      { text: "I fix it up.", correct: true, feedback: "Tire patched‚Äîready to ride! üö¥" },
      { text: "I fix it out.", correct: false, feedback: "You toss the tire away‚Äîno bike! üò±" },
      { text: "I fix it off.", correct: false, feedback: "You ignore it‚Äîstill flat! üò£" },
      { text: "I fix it in.", correct: false, feedback: "You stuff the tire indoors‚Äîuseless! üòÜ" }
    ]},
    { topic: "general", text: "You want to decorate your room. What do you do? üñºÔ∏è", emojis: "üñºÔ∏èüè†", choices: [
      { text: "I spruce it up.", correct: true, feedback: "Room looks amazing‚Äîdecor win! ‚ú®" },
      { text: "I spruce it out.", correct: false, feedback: "You plant trees indoors‚Äîwild! üå≥" },
      { text: "I spruce it off.", correct: false, feedback: "You skip decorating‚Äîboring room! üò¥" },
      { text: "I spruce it in.", correct: false, feedback: "You hide decor in a box‚Äîno style! üòÖ" }
    ]},
    // Work (26 scenarios)
    { topic: "work", text: "Your boss needs a report quickly. What do you do? üìä", emojis: "üìäüíº", choices: [
      { text: "I whip it up.", correct: true, feedback: "Report done fast, boss impressed! üòä" },
      { text: "I whip it out.", correct: false, feedback: "You dramatically pull out a whip‚Äîchaos! üíÉ" },
      { text: "I whip it off.", correct: false, feedback: "You take off your jacket instead of writing! üòÜ" },
      { text: "I whip it down.", correct: false, feedback: "You scribble nonsense and spill coffee! üìùüòµ" }
    ]},
    { topic: "work", text: "A client is waiting for your call. What do you do? üìû", emojis: "üìûüíº", choices: [
      { text: "I call them up.", correct: true, feedback: "Client‚Äôs happy, deal sealed! üòé" },
      { text: "I call them off.", correct: false, feedback: "You cancel the call‚Äîdeal lost! üò£" },
      { text: "I call them out.", correct: false, feedback: "You challenge the client to a duel! üò¨" },
      { text: "I call them in.", correct: false, feedback: "You invite them to your office now‚Äîawkward! üòÖ" }
    ]},
    { topic: "work", text: "You need to organize a team meeting. What do you do? üìÖ", emojis: "üìÖüë•", choices: [
      { text: "I set it up.", correct: true, feedback: "Meeting scheduled‚Äîteam aligned! ü•≥" },
      { text: "I set it off.", correct: false, feedback: "You trigger a fire alarm‚Äîchaos! üö®" },
      { text: "I set it out.", correct: false, feedback: "You plan it outdoors in a storm! üåßÔ∏è" },
      { text: "I set it in.", correct: false, feedback: "You lock the meeting in a drawer! üîí" }
    ]},
    { topic: "work", text: "You need to finish a presentation. What do you do? üñ•Ô∏è", emojis: "üñ•Ô∏èüìà", choices: [
      { text: "I wrap it up.", correct: true, feedback: "Slides done, ready to shine! ‚ú®" },
      { text: "I wrap it out.", correct: false, feedback: "You gift-wrap it and send it away! üéÅ" },
      { text: "I wrap it off.", correct: false, feedback: "You abandon it halfway‚Äîoops! üò¥" },
      { text: "I wrap it in.", correct: false, feedback: "You hide it in a folder‚Äîforgotten! üòÖ" }
    ]},
    { topic: "work", text: "Your desk is cluttered. What do you do? üñáÔ∏è", emojis: "üñáÔ∏èüíº", choices: [
      { text: "I tidy it up.", correct: true, feedback: "Desk sparkles‚Äîproductivity boost! üòä" },
      { text: "I tidy it out.", correct: false, feedback: "You throw all papers away‚Äîimportant ones too! üò±" },
      { text: "I tidy it off.", correct: false, feedback: "You push everything off the desk! üòÜ" },
      { text: "I tidy it in.", correct: false, feedback: "You stuff papers in a drawer‚Äîmessy still! üòÖ" }
    ]},
    { topic: "work", text: "You need to review a contract. What do you do? üìú", emojis: "üìúüíº", choices: [
      { text: "I look it over.", correct: true, feedback: "Contract checked‚Äîsolid deal! ‚úÖ" },
      { text: "I look it up.", correct: false, feedback: "You google the contract‚Äîwrong move! üòÖ" },
      { text: "I look it out.", correct: false, feedback: "You stare out the window instead! üò¥" },
      { text: "I look it off.", correct: false, feedback: "You dismiss it without reading! üò£" }
    ]},
    { topic: "work", text: "You need to submit a report. What do you do? üì§", emojis: "üì§üíº", choices: [
      { text: "I hand it in.", correct: true, feedback: "Report submitted‚Äîboss pleased! üòé" },
      { text: "I hand it out.", correct: false, feedback: "You give copies to everyone‚Äîconfidentiality breach! üò±" },
      { text: "I hand it off.", correct: false, feedback: "You pass it to a random coworker! üòÜ" },
      { text: "I hand it up.", correct: false, feedback: "You throw it in the air‚Äîpapers everywhere! üìÑ" }
    ]},
    { topic: "work", text: "A meeting is getting heated. What do you do? üî•", emojis: "üî•üíº", choices: [
      { text: "I calm it down.", correct: true, feedback: "Everyone chills‚Äîmeeting saved! üòä" },
      { text: "I calm it up.", correct: false, feedback: "You make tempers rise even higher! üò£" },
      { text: "I calm it out.", correct: false, feedback: "You herd everyone outside like cats! üå≥" },
      { text: "I calm it off.", correct: false, feedback: "You abruptly end the meeting‚Äîunresolved! üòÆ" }
    ]},
    { topic: "work", text: "You need to update a project plan. What do you do? üìà", emojis: "üìàüíº", choices: [
      { text: "I write it up.", correct: true, feedback: "Plan updated‚Äîteam on track! ‚úÖ" },
      { text: "I write it out.", correct: false, feedback: "You copy it by hand‚Äîtime wasted! üòÖ" },
      { text: "I write it off.", correct: false, feedback: "You dismiss the plan‚Äîproject fails! üò£" },
      { text: "I write it in.", correct: false, feedback: "You scribble it in a notebook‚Äîlost! üòÜ" }
    ]},
    { topic: "work", text: "You need to end a long meeting. What do you do? üïí", emojis: "üïíüíº", choices: [
      { text: "I wrap it up.", correct: true, feedback: "Meeting done‚Äîtime saved! üòé" },
      { text: "I wrap it out.", correct: false, feedback: "You send everyone home‚Äîconfused! üòÖ" },
      { text: "I wrap it off.", correct: false, feedback: "You cancel it halfway‚Äîchaos! üò£" },
      { text: "I wrap it in.", correct: false, feedback: "You trap everyone in discussion‚Äîstuck! üòÜ" }
    ]},
    { topic: "work", text: "You need to find a file on your computer. What do you do? üíª", emojis: "üíªüìÇ", choices: [
      { text: "I look it up.", correct: true, feedback: "File found‚Äîwork continues! ü•≥" },
      { text: "I look it over.", correct: false, feedback: "You skim random files‚Äîwrong one! üòÖ" },
      { text: "I look it out.", correct: false, feedback: "You stare at the screen blankly! üò¥" },
      { text: "I look it off.", correct: false, feedback: "You ignore the search‚Äîlost file! üò£" }
    ]},
    { topic: "work", text: "You need to train a new employee. What do you do? üë®‚Äçüè´", emojis: "üë®‚Äçüè´üíº", choices: [
      { text: "I show them around.", correct: true, feedback: "Newbie oriented‚Äîgreat mentor! üòä" },
      { text: "I show them out.", correct: false, feedback: "You escort them out‚Äîfired already? üò±" },
      { text: "I show them off.", correct: false, feedback: "You brag about them‚Äîawkward! üòÖ" },
      { text: "I show them in.", correct: false, feedback: "You lock them in the office‚Äîtrapped! üòÜ" }
    ]},
    { topic: "work", text: "You need to reject a bad proposal. What do you do? üìù", emojis: "üìùüö´", choices: [
      { text: "I turn it down.", correct: true, feedback: "Proposal rejected‚Äîsmart move! ‚úÖ" },
      { text: "I turn it up.", correct: false, feedback: "You amplify the bad idea‚Äîdisaster! üò£" },
      { text: "I turn it off.", correct: false, feedback: "You ignore it completely‚Äîmissed chance! üòÖ" },
      { text: "I turn it in.", correct: false, feedback: "You submit it as your own‚Äîoops! üòÜ" }
    ]},
    { topic: "work", text: "You need to prepare a budget. What do you do? üí∏", emojis: "üí∏üìä", choices: [
      { text: "I draw it up.", correct: true, feedback: "Budget ready‚Äîfinance approved! üòé" },
      { text: "I draw it out.", correct: false, feedback: "You sketch it slowly‚Äîdeadline missed! üòÖ" },
      { text: "I draw it off.", correct: false, feedback: "You doodle instead of budgeting! üòÜ" },
      { text: "I draw it in.", correct: false, feedback: "You hide the budget in a file‚Äîlost! üò¥" }
    ]},
    { topic: "work", text: "A project is behind schedule. What do you do? ‚è∞", emojis: "‚è∞üíº", choices: [
      { text: "I catch up.", correct: true, feedback: "Deadlines met‚Äîteam celebrates! üöÄ" },
      { text: "I catch out.", correct: false, feedback: "You expose a coworker's mistake‚Äîdrama! üò£" },
      { text: "I catch in.", correct: false, feedback: "You get tangled in red tape meetings! üò©" },
      { text: "I catch off.", correct: false, feedback: "You doze off during overtime! üò¥" }
    ]},
    { topic: "work", text: "You need to resolve a conflict at work. What do you do? ü§ù", emojis: "ü§ùüíº", choices: [
      { text: "I smooth it over.", correct: true, feedback: "Harmony restored‚Äîteam united! üòä" },
      { text: "I smooth it out.", correct: false, feedback: "You flatten the issue literally‚Äîawkward! üòÖ" },
      { text: "I smooth it off.", correct: false, feedback: "You dismiss it‚Äîtension grows! üò£" },
      { text: "I smooth it in.", correct: false, feedback: "You bury the conflict‚Äîexplodes later! üòÜ" }
    ]},
    { topic: "work", text: "You need to cancel a meeting. What do you do? üìÖ", emojis: "üìÖüö´", choices: [
      { text: "I call it off.", correct: true, feedback: "Meeting canceled‚Äîtime freed! üòé" },
      { text: "I call it up.", correct: false, feedback: "You schedule more meetings‚Äîoverbooked! üò£" },
      { text: "I call it out.", correct: false, feedback: "You publicly criticize it‚Äîdrama! üòÖ" },
      { text: "I call it in.", correct: false, feedback: "You move it indoors‚Äîsame problem! üòÜ" }
    ]},
    { topic: "work", text: "You need to prepare for a client pitch. What do you do? üé§", emojis: "üé§üíº", choices: [
      { text: "I brush up.", correct: true, feedback: "Skills polished‚Äîpitch perfect! ‚ú®" },
      { text: "I brush out.", correct: false, feedback: "You sweep the room instead‚Äîwrong prep! üòÖ" },
      { text: "I brush off.", correct: false, feedback: "You ignore the pitch‚Äîclient lost! üò£" },
      { text: "I brush in.", correct: false, feedback: "You paint the slides‚Äîartsy fail! üòÜ" }
    ]},
    { topic: "work", text: "You need to distribute tasks. What do you do? üìã", emojis: "üìãüë•", choices: [
      { text: "I hand them out.", correct: true, feedback: "Tasks assigned‚Äîteam rolling! ‚úÖ" },
      { text: "I hand them in.", correct: false, feedback: "You submit tasks to yourself‚Äîconfused! üòÖ" },
      { text: "I hand them off.", correct: false, feedback: "You delegate everything‚Äîlazy! üò¥" },
      { text: "I hand them up.", correct: false, feedback: "You toss tasks in the air‚Äîchaos! üòÜ" }
    ]},
    { topic: "work", text: "You need to improve a process. What do you do? ‚öôÔ∏è", emojis: "‚öôÔ∏èüíº", choices: [
      { text: "I streamline it.", correct: true, feedback: "Process optimized‚Äîefficiency king! üòé" },
      { text: "I streamline out.", correct: false, feedback: "You remove the process entirely‚Äîoops! üò£" },
      { text: "I streamline off.", correct: false, feedback: "You ignore it‚Äîinefficiency rules! üòÖ" },
      { text: "I streamline in.", correct: false, feedback: "You complicate it with extra steps! üòÜ" }
    ]},
    { topic: "work", text: "You need to prepare for a big meeting. What do you do? üìÖ", emojis: "üìÖüíº", choices: [
      { text: "I gear up.", correct: true, feedback: "Ready to impress‚Äîmeeting nailed! üòé" },
      { text: "I gear out.", correct: false, feedback: "You dress for hiking‚Äîwrong vibe! ü•æ" },
      { text: "I gear off.", correct: false, feedback: "You skip prep‚Äîunprepared! üò£" },
      { text: "I gear in.", correct: false, feedback: "You lock yourself in a closet‚Äîmissing! üòÜ" }
    ]},
    { topic: "work", text: "You need to share a document with your team. What do you do? üìÑ", emojis: "üìÑüë•", choices: [
      { text: "I send it out.", correct: true, feedback: "Team has the doc‚Äîcollaboration on! ‚úÖ" },
      { text: "I send it up.", correct: false, feedback: "You email it to the CEO‚Äîoops! üòÖ" },
      { text: "I send it off.", correct: false, feedback: "You delete it instead‚Äîgone! üò±" },
      { text: "I send it in.", correct: false, feedback: "You hide it in your inbox‚Äîuseless! üòÜ" }
    ]},
    { topic: "work", text: "You need to clean your workspace. What do you do? üñáÔ∏è", emojis: "üñáÔ∏èüíº", choices: [
      { text: "I clear it out.", correct: true, feedback: "Workspace spotless‚Äîfocus mode! ‚ú®" },
      { text: "I clear it up.", correct: false, feedback: "You organize it into chaos‚Äîmessy! üòÖ" },
      { text: "I clear it off.", correct: false, feedback: "You sweep papers to the floor! üò£" },
      { text: "I clear it in.", correct: false, feedback: "You stuff junk in drawers‚Äîhidden mess! üòÜ" }
    ]},
    { topic: "work", text: "You need to start a new project. What do you do? üöÄ", emojis: "üöÄüíº", choices: [
      { text: "I kick it off.", correct: true, feedback: "Project launched‚Äîteam excited! ü•≥" },
      { text: "I kick it up.", correct: false, feedback: "You escalate it too fast‚Äîoverwhelmed! üòÖ" },
      { text: "I kick it out.", correct: false, feedback: "You cancel it before starting! üò£" },
      { text: "I kick it in.", correct: false, feedback: "You hide the project‚Äîforgotten! üòÜ" }
    ]},
    { topic: "work", text: "You need to check a colleague‚Äôs work. What do you do? üìù", emojis: "üìùüíº", choices: [
      { text: "I go over it.", correct: true, feedback: "Work reviewed‚Äîgreat feedback! ‚úÖ" },
      { text: "I go out it.", correct: false, feedback: "You leave to avoid it‚Äîslacker! üòÖ" },
      { text: "I go off it.", correct: false, feedback: "You rant about it‚Äîdrama! üò£" },
      { text: "I go in it.", correct: false, feedback: "You dive into their files‚Äîprivacy breach! üòÜ" }
    ]},
    { topic: "work", text: "You want to improve your skills. What do you do? üß†", emojis: "üß†üíº", choices: [
      { text: "I brush up.", correct: true, feedback: "Skills sharpened‚Äîcareer boost! ‚ú®" },
      { text: "I brush out.", correct: false, feedback: "You sweep the office instead‚Äîwrong task! üòÖ" },
      { text: "I brush off.", correct: false, feedback: "You ignore learning‚Äîstagnant! üò£" },
      { text: "I brush in.", correct: false, feedback: "You paint your skills‚Äîartsy fail! üòÜ" }
    ]},
    // Social (26 scenarios)
    { topic: "social", text: "Your friend is telling a boring story. What do you do? üò¥", emojis: "üò¥üéâ", choices: [
      { text: "I tune it out.", correct: true, feedback: "You politely nod and daydream‚Äîstory over soon! üòå" },
      { text: "I tune it in.", correct: false, feedback: "You focus too hard and get even more bored! üò©" },
      { text: "I tune it up.", correct: false, feedback: "You adjust the 'volume' and turn it into a sing-along! üï∫" },
      { text: "I tune it off.", correct: false, feedback: "You pretend to mute your friend‚Äîsuper awkward! üò¨" }
    ]},
    { topic: "social", text: "You‚Äôre invited to a party. What do you do? üéâ", emojis: "üéâüéà", choices: [
      { text: "I show up.", correct: true, feedback: "You arrive, party‚Äôs better with you! ü•≥" },
      { text: "I show out.", correct: false, feedback: "You leave early to avoid dancing! üòÖ" },
      { text: "I show off.", correct: false, feedback: "You flex your dance moves‚Äîtoo much! üíÉ" },
      { text: "I show in.", correct: false, feedback: "You hide in the kitchen all night! üò¥" }
    ]},
    { topic: "social", text: "Your friend is upset. What do you do? üò¢", emojis: "üò¢ü§ó", choices: [
      { text: "I cheer them up.", correct: true, feedback: "Friend‚Äôs smiling again‚Äînice one! üòä" },
      { text: "I cheer them out.", correct: false, feedback: "You send them away‚Äîstill sad! üò£" },
      { text: "I cheer them off.", correct: false, feedback: "You shoo them like a fly‚Äîrude! üò¨" },
      { text: "I cheer them in.", correct: false, feedback: "You invite more sadness in‚Äîoops! üòÖ" }
    ]},
    { topic: "social", text: "You want to join a conversation. What do you do? üí¨", emojis: "üí¨üë•", choices: [
      { text: "I jump in.", correct: true, feedback: "You‚Äôre part of the chat‚Äîgreat input! üòé" },
      { text: "I jump out.", correct: false, feedback: "You leap away from the group‚Äîmissed out! üò¥" },
      { text: "I jump up.", correct: false, feedback: "You literally jump, startling everyone! üòÜ" },
      { text: "I jump off.", correct: false, feedback: "You ditch the convo for no reason! üòÖ" }
    ]},
    { topic: "social", text: "You‚Äôre planning a group outing. What do you do? üåÑ", emojis: "üåÑüë•", choices: [
      { text: "I plan it out.", correct: true, feedback: "Trip planned‚Äîeveryone‚Äôs excited! ü•≥" },
      { text: "I plan it up.", correct: false, feedback: "You escalate to a world tour‚Äîtoo much! üåç" },
      { text: "I plan it off.", correct: false, feedback: "You cancel the outing‚Äîboo! üò£" },
      { text: "I plan it in.", correct: false, feedback: "You plan a stay-home party‚Äîlame! üò¥" }
    ]},
    { topic: "social", text: "You need to decline an invitation. What do you do? üì©", emojis: "üì©üö´", choices: [
      { text: "I turn it down.", correct: true, feedback: "Polite decline‚Äîwell handled! üòä" },
      { text: "I turn it up.", correct: false, feedback: "You make it a bigger event‚Äîovercommitted! üòÖ" },
      { text: "I turn it off.", correct: false, feedback: "You ghost the invite‚Äîawkward! üò¨" },
      { text: "I turn it in.", correct: false, feedback: "You submit it as homework‚Äîwrong move! üòÜ" }
    ]},
    { topic: "social", text: "You want to make a good impression at a party. What do you do? üòé", emojis: "üòéüéâ", choices: [
      { text: "I dress up.", correct: true, feedback: "Looking sharp‚Äîeveryone‚Äôs impressed! ‚ú®" },
      { text: "I dress out.", correct: false, feedback: "You wear hiking gear to the party! üòÖ" },
      { text: "I dress off.", correct: false, feedback: "You show up in pajamas‚Äîtoo casual! üò¥" },
      { text: "I dress in.", correct: false, feedback: "You hide in baggy clothes‚Äîno spotlight! üòÜ" }
    ]},
    { topic: "social", text: "You want to join a group chat. What do you do? üí¨", emojis: "üí¨üéâ", choices: [
      { text: "I chime in.", correct: true, feedback: "Your comment fits right in‚Äîgroup loves it! üòÑ" },
      { text: "I chime out.", correct: false, feedback: "You mute yourself‚Äîchat ignores you! üòî" },
      { text: "I chime up.", correct: false, feedback: "You start ringing bells in the chat! üé§" },
      { text: "I chime off.", correct: false, feedback: "You log off before saying anything! üö™" }
    ]},
    { topic: "social", text: "You want to leave a boring event. What do you do? üò¥", emojis: "üò¥üéà", choices: [
      { text: "I sneak out.", correct: true, feedback: "Smooth exit‚Äîno one notices! üòé" },
      { text: "I sneak up.", correct: false, feedback: "You tiptoe loudly‚Äîeveryone stares! üòÖ" },
      { text: "I sneak in.", correct: false, feedback: "You go back for more boredom! üò¥" },
      { text: "I sneak off.", correct: false, feedback: "You trip and make a scene‚Äîoops! üòÜ" }
    ]},
    { topic: "social", text: "You want to impress at a dinner party. What do you do? üçΩÔ∏è", emojis: "üçΩÔ∏èüéâ", choices: [
      { text: "I show off.", correct: true, feedback: "Your charm wins the table‚Äîstar of the night! ‚ú®" },
      { text: "I show up.", correct: false, feedback: "You just arrive‚Äîno one‚Äôs impressed yet! üòÖ" },
      { text: "I show out.", correct: false, feedback: "You leave early‚Äîmissed the fun! üò£" },
      { text: "I show in.", correct: false, feedback: "You hide in the kitchen‚Äîshy chef? üòÜ" }
    ]},
    { topic: "social", text: "You need to organize a friend‚Äôs birthday. What do you do? üéÇ", emojis: "üéÇüéâ", choices: [
      { text: "I set it up.", correct: true, feedback: "Party planned‚Äîbirthday success! ü•≥" },
      { text: "I set it off.", correct: false, feedback: "You start a fire with candles‚Äîchaos! üî•" },
      { text: "I set it out.", correct: false, feedback: "You plan it in a field‚Äîrained out! üåßÔ∏è" },
      { text: "I set it in.", correct: false, feedback: "You lock the party indoors‚Äîcramped! üòÖ" }
    ]},
    { topic: "social", text: "You want to help a friend with a task. What do you do? ü§ù", emojis: "ü§ùüéâ", choices: [
      { text: "I pitch in.", correct: true, feedback: "Teamwork makes the dream work! üòä" },
      { text: "I pitch out.", correct: false, feedback: "You throw the task away‚Äîoops! üòÖ" },
      { text: "I pitch up.", correct: false, feedback: "You raise the stakes too high! üò£" },
      { text: "I pitch off.", correct: false, feedback: "You dodge helping entirely! üò¥" }
    ]},
    { topic: "social", text: "You‚Äôre arguing with a friend. What do you do? üò£", emojis: "üò£üë•", choices: [
      { text: "I make up.", correct: true, feedback: "Friendship restored‚Äîhugs all around! ü§ó" },
      { text: "I make out.", correct: false, feedback: "You kiss and confuse everyone! üò≥" },
      { text: "I make off.", correct: false, feedback: "You run away from the argument! üòÖ" },
      { text: "I make in.", correct: false, feedback: "You drag the fight indoors‚Äîtense! üòÜ" }
    ]},
    { topic: "social", text: "You want to share a cool idea. What do you do? üí°", emojis: "üí°üéâ", choices: [
      { text: "I bring it up.", correct: true, feedback: "Idea shared‚Äîeveryone loves it! üòé" },
      { text: "I bring it out.", correct: false, feedback: "You present it outside in the rain‚Äîsoggy! üåßÔ∏è" },
      { text: "I bring it off.", correct: false, feedback: "You abandon the idea‚Äîlost chance! üò£" },
      { text: "I bring it in.", correct: false, feedback: "You hide it in a box‚Äîno one sees! üòÖ" }
    ]},
    { topic: "social", text: "You need to end a conversation politely. What do you do? üòä", emojis: "üòäüéâ", choices: [
      { text: "I bow out.", correct: true, feedback: "Graceful goodbye‚Äîthey understand! üòé" },
      { text: "I bow in.", correct: false, feedback: "You keep bowing awkwardly like a robot! üòÖ" },
      { text: "I bow up.", correct: false, feedback: "You puff up and challenge them to a duel! üí™" },
      { text: "I bow off.", correct: false, feedback: "You trip and bow out the door‚Äîliterally! üò¨" }
    ]},
    { topic: "social", text: "You want to reconnect with an old friend. What do you do? üìû", emojis: "üìûüë•", choices: [
      { text: "I catch up.", correct: true, feedback: "Great chat‚Äîfriendship revived! üòä" },
      { text: "I catch out.", correct: false, feedback: "You expose their old secrets‚Äîawkward! üòÖ" },
      { text: "I catch off.", correct: false, feedback: "You hang up early‚Äîmissed chance! üò£" },
      { text: "I catch in.", correct: false, feedback: "You trap them in a long call‚Äîtiring! üòÜ" }
    ]},
    { topic: "social", text: "You want to avoid a boring topic. What do you do? üò¥", emojis: "üò¥üí¨", choices: [
      { text: "I steer away.", correct: true, feedback: "Topic changed‚Äîconversation saved! üòé" },
      { text: "I steer up.", correct: false, feedback: "You escalate the boring talk‚Äîyawn! üòÖ" },
      { text: "I steer off.", correct: false, feedback: "You derail the chat completely! üò£" },
      { text: "I steer in.", correct: false, feedback: "You dive deeper into boredom! üò¥" }
    ]},
    { topic: "social", text: "You need to apologize to a friend. What do you do? üòî", emojis: "üòîü§ù", choices: [
      { text: "I make it up.", correct: true, feedback: "Apology accepted‚Äîfriendship back! üòä" },
      { text: "I make it out.", correct: false, feedback: "You kiss and confuse them! üò≥" },
      { text: "I make it off.", correct: false, feedback: "You run from the apology‚Äîawkward! üòÖ" },
      { text: "I make it in.", correct: false, feedback: "You hide your apology‚Äîunseen! üòÜ" }
    ]},
    { topic: "social", text: "You want to share gossip. What do you do? üó£Ô∏è", emojis: "üó£Ô∏èüéâ", choices: [
      { text: "I pass it on.", correct: true, feedback: "Gossip shared‚Äîparty buzzes! ü•≥" },
      { text: "I pass it out.", correct: false, feedback: "You faint from gossip overload! üòÖ" },
      { text: "I pass it off.", correct: false, feedback: "You dismiss it‚Äîboring party! üò£" },
      { text: "I pass it in.", correct: false, feedback: "You whisper it to yourself‚Äîpointless! üòÜ" }
    ]},
    { topic: "social", text: "You want to calm an angry friend. What do you do? üò£", emojis: "üò£ü§ó", choices: [
      { text: "I talk them down.", correct: true, feedback: "Friend‚Äôs calm‚Äîcrisis averted! üòä" },
      { text: "I talk them up.", correct: false, feedback: "You hype them up‚Äîmore anger! üòÖ" },
      { text: "I talk them out.", correct: false, feedback: "You convince them to leave‚Äîoops! üò£" },
      { text: "I talk them in.", correct: false, feedback: "You trap them in a lecture‚Äîworse! üòÜ" }
    ]},
    { topic: "social", text: "You want to start a conversation at a party. What do you do? üéâ", emojis: "üéâüí¨", choices: [
      { text: "I strike it up.", correct: true, feedback: "Chat‚Äôs flowing‚Äîparty star! üòé" },
      { text: "I strike it out.", correct: false, feedback: "You swing and miss‚Äîawkward silence! üòÖ" },
      { text: "I strike it off.", correct: false, feedback: "You avoid talking‚Äîlonely corner! üò£" },
      { text: "I strike it in.", correct: false, feedback: "You whisper to yourself‚Äîno one hears! üòÜ" }
    ]},
    { topic: "social", text: "You need to calm a loud argument. What do you do? üò£", emojis: "üò£üë•", choices: [
      { text: "I settle it down.", correct: true, feedback: "Peace restored‚Äîhero moment! üòä" },
      { text: "I settle it up.", correct: false, feedback: "You make it louder‚Äîchaos! üòÖ" },
      { text: "I settle it out.", correct: false, feedback: "You move the fight outside‚Äîstill loud! üò£" },
      { text: "I settle it in.", correct: false, feedback: "You trap everyone in silence‚Äîtense! üòÜ" }
    ]};

    let currentScenarioIndex = 0;
    let score = 0;
    let selectedScenarios = [];
    let totalQuestions = 50;
    let timerEnabled = false;
    let timeLimit = 15;
    let timerInterval = null;
    let currentTime = 0;
    let difficulty = 'medium';
    let topic = 'general';

    const correctSound = document.getElementById('correct-sound');
    const wrongSound = document.getElementById('wrong-sound');
    const sprite = document.getElementById('sprite');

    // Toggle timer input visibility
    document.getElementById('timer-toggle').addEventListener('change', function() {
      document.getElementById('timer-input').classList.toggle('hidden', !this.checked);
    });

    // Start game
    document.getElementById('start-button').addEventListener('click', () => {
      difficulty = document.getElementById('difficulty').value;
      topic = document.getElementById('topic').value;
      totalQuestions = Math.min(Math.max(parseInt(document.getElementById('num-questions').value) || 50, 1), 50);
      timerEnabled = document.getElementById('timer-toggle').checked;
      timeLimit = timerEnabled ? Math.min(Math.max(parseInt(document.getElementById('time-limit').value) || 15, 5), 60) : 15;

      // Filter scenarios based on topic and difficulty
      let availableScenarios = scenarios[difficulty];
      if (topic !== 'general') {
        availableScenarios = availableScenarios.filter(s => s.topic === topic);
      }
      if (availableScenarios.length === 0) {
        alert('No scenarios available for this topic and difficulty. Try another combination.');
        return;
      }
      // Repeat scenarios if not enough to meet totalQuestions
      while (availableScenarios.length < totalQuestions) {
        availableScenarios = availableScenarios.concat(availableScenarios);
      }
      selectedScenarios = shuffle(availableScenarios).slice(0, totalQuestions);

      currentScenarioIndex = 0;
      score = 0;
      document.getElementById('score-value').textContent = score;
      document.getElementById('menu-container').classList.add('hidden');
      document.getElementById('game-container').classList.remove('hidden');
      loadScenario();
    });

    // Shuffle array
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Load scenario
    function loadScenario() {
      // Only end game if all questions are answered
      if (currentScenarioIndex >= selectedScenarios.length) {
        endGame();
        return;
      }

      const scenario = selectedScenarios[currentScenarioIndex];
      document.getElementById('scenario').textContent = scenario.text;
      document.getElementById('scenario-emojis').textContent = scenario.emojis;
      document.getElementById('progress-text').textContent = `Question ${currentScenarioIndex + 1}/${selectedScenarios.length}`;
      document.getElementById('progress').style.width = `${((currentScenarioIndex + 1) / selectedScenarios.length) * 100}%`;

      const choicesDiv = document.getElementById('choices');
      choicesDiv.innerHTML = '';
      shuffle(scenario.choices).forEach(choice => {
        const button = document.createElement('button');
        button.className = 'w-full bg-gray-200 py-2 rounded hover:bg-gray-300';
        button.textContent = choice.text;
        button.addEventListener('click', () => handleChoice(choice));
        choicesDiv.appendChild(button);
      });

      document.getElementById('feedback').classList.add('hidden');
      document.getElementById('next-button').classList.add('hidden');
      sprite.textContent = 'üßë‚Äçüéì';

      if (timerEnabled) {
        currentTime = timeLimit;
        document.getElementById('timer-display').textContent = `Time: ${currentTime}s`;
        document.getElementById('timer-display').classList.remove('hidden');
        startTimer();
      }
    }

    // Handle choice
    function handleChoice(choice) {
      clearInterval(timerInterval);
      document.getElementById('timer-display').classList.add('hidden');
      const feedback = document.getElementById('feedback');
      feedback.textContent = choice.feedback;
      feedback.classList.remove('hidden');

      const points = {
        easy: { correct: 8, wrong: -3 },
        medium: { correct: 10, wrong: -5 },
        hard: { correct: 12, wrong: -7 }
      };

      if (choice.correct) {
        score += points[difficulty].correct;
        document.body.classList.add('flash-green');
        sprite.textContent = 'üòé';
        correctSound.play().catch(() => {});
        setTimeout(() => document.body.classList.remove('flash-green'), 500);
      } else {
        score += points[difficulty].wrong;
        document.body.classList.add('shake');
        sprite.textContent = 'üòÖ';
        wrongSound.play().catch(() => {});
        setTimeout(() => document.body.classList.remove('shake'), 500);
      }

      // Clamp score to -10 min
      if (score < -10) score = -10;
      document.getElementById('score-value').textContent = score;
      document.getElementById('next-button').classList.remove('hidden');

      // Only end game if score is -10 or below
      if (score <= -10) {
        endGame();
      }
    }

    // Start timer
    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        currentTime--;
        document.getElementById('timer-display').textContent = `Time: ${currentTime}s`;
        if (currentTime <= 0) {
          clearInterval(timerInterval);
          score -= 2;
          if (score < -10) score = -10;
          document.getElementById('score-value').textContent = score;
          document.getElementById('feedback').textContent = 'Time‚Äôs up! -2 points üòì';
          document.getElementById('feedback').classList.remove('hidden');
          document.getElementById('next-button').classList.remove('hidden');
          sprite.textContent = 'üòì';
          wrongSound.play().catch(() => {});
          if (score <= -10) {
            endGame();
          }
        }
      }, 1000);
    }

    // Next scenario
    document.getElementById('next-button').addEventListener('click', () => {
      currentScenarioIndex++;
      loadScenario();
    });

    // End game
    function endGame() {
      clearInterval(timerInterval);
      document.getElementById('game-container').classList.add('hidden');
      document.getElementById('game-over').classList.remove('hidden');
      const message = score <= -10
        ? `Game Over! Score: ${score}. Too many mistakes! üò¢ Try again?`
        : `Game Over! Final Score: ${score}. Great job! üéâ Play again?`;
      document.getElementById('game-over-message').textContent = message;
    }

    // Restart game
    document.getElementById('restart-button').addEventListener('click', () => {
      currentScenarioIndex = 0;
      score = 0;
      document.getElementById('score-value').textContent = score;
      document.getElementById('game-over').classList.add('hidden');
      document.getElementById('menu-container').classList.remove('hidden');
    });
  </script>
</body>
</html>
